<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CGPA Calculator</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Made+Cannes&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      transition: background 0.5s, color 0.5s;
      background: #ffffff;
      color: #111;
    }

    .dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }

    .main {
      max-width: 900px;
      margin: auto;
      padding: 30px 20px;
    }
h2 {
  text-align: center;
  font-size: 34px;
  font-family: 'Made Cannes', sans-serif;
}


    label {
      font-weight: 600;
      margin-top: 20px;
      display: block;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    button {
      padding: 12px 20px;
      margin-top: 20px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 30px;
      border: none;
      background: #4e54c8;
      color: #fff;
      cursor: pointer;
    }

    button:hover {
      background: #6c70f3;
    }

    .subject-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .subject-row input {
      flex: 1;
    }

    .result {
      font-size: 18px;
      margin-top: 30px;
      font-weight: bold;
      text-align: center;
    }

    .formulas {
      margin-top: 30px;
      font-style: italic;
      font-size: 15px;
      background: rgba(200, 200, 200, 0.1);
      padding: 15px;
      border-radius: 10px;
    }

    .dark-mode .formulas {
      background-color: #1f1f1f;
    }

    /* Toggle */
    .toggle-container {
      position: absolute;
      top: 20px;
      right: 20px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 34px;
      top: 0; left: 0; right: 0; bottom: 0;
    }

    .slider:before {
      position: absolute;
      content: "ðŸŒž";
      height: 26px;
      width: 26px;
      left: 2px;
      bottom: 2px;
      text-align: center;
      background-color: white;
      color: black;
      transition: 0.4s;
      line-height: 26px;
      border-radius: 50%;
      font-size: 16px;
    }

    input:checked + .slider:before {
      transform: translateX(30px);
      content: "ðŸŒ™";
    }

    input:checked + .slider {
      background-color: #666;
    }

    canvas {
      margin-top: 40px;
      background-color: #fff;
      border-radius: 10px;
    }

    .dark-mode canvas {
      background-color: #1e1e1e;
    }

    @media screen and (max-width: 600px) {
      .subject-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
<div class="toggle-container">
  <label class="switch">
    <input type="checkbox" onchange="toggleDarkMode(this)">
    <span class="slider"></span>
  </label>
</div>

<div class="main" id="mainContainer">
  <h2>ðŸŽ“ CGPA Calculator</h2>

  <label for="prevCredits">Previous Total Credit Points:</label>
  <input type="number" id="prevCredits" placeholder="e.g., 100">

  <label for="prevCgpa">Previous CGPA:</label>
  <input type="number" step="0.01" id="prevCgpa" placeholder="e.g., 8.5">

  <label for="numSubjects">Number of Current Subjects:</label>
  <input type="number" id="numSubjects" min="1" placeholder="e.g., 6">

  <button onclick="generateInputs()">âž• Enter Subject Grades</button>
  <div id="subjectsContainer"></div>

  <button onclick="calculateCGPA()">ðŸ§® Calculate CGPA</button>
  <div class="result" id="result"></div>

  <canvas id="cgpaChart" width="800" height="300"></canvas>
  <button onclick="downloadPDF()">ðŸ“„ Download PDF</button>

  <div class="formulas">
    <strong>Formulas:</strong><br>
    âž¤ Semester CGPA = Î£ (Grade Point Ã— Credit) / Î£ Credits<br>
    âž¤ Cumulative CGPA = (Previous CGPA Ã— Previous Credits + Current Semester Points) / (Previous + Current Credits)
  </div>
</div>

<script>
  let chart;

  function toggleDarkMode(toggle) {
    document.body.classList.toggle('dark-mode', toggle.checked);
    if (chart) {
      chart.options.scales.x.ticks.color = toggle.checked ? "#fff" : "#000";
      chart.options.scales.y.ticks.color = toggle.checked ? "#fff" : "#000";
      chart.update();
    }
  }

  function generateInputs() {
    const count = parseInt(document.getElementById('numSubjects').value);
    const container = document.getElementById('subjectsContainer');
    container.innerHTML = "";

    for (let i = 1; i <= count; i++) {
      const row = document.createElement('div');
      row.className = 'subject-row';
      row.innerHTML = `
        <input type="number" class="grade" placeholder="Grade Point ${i}" step="0.01">
        <input type="number" class="credit" placeholder="Credit Point ${i}" step="1">
      `;
      container.appendChild(row);
    }
  }

  function calculateCGPA() {
    const prevCredits = parseFloat(document.getElementById('prevCredits').value);
    const prevCgpa = parseFloat(document.getElementById('prevCgpa').value);

    const gradeInputs = document.querySelectorAll('.grade');
    const creditInputs = document.querySelectorAll('.credit');

    let currTotalCredits = 0, currTotalPoints = 0;

    for (let i = 0; i < gradeInputs.length; i++) {
      const grade = parseFloat(gradeInputs[i].value);
      const credit = parseFloat(creditInputs[i].value);
      if (isNaN(grade) || isNaN(credit)) {
        alert("Please enter all grades and credits.");
        return;
      }
      currTotalCredits += credit;
      currTotalPoints += grade * credit;
    }

    const currCgpa = currTotalPoints / currTotalCredits;
    const totalCredits = prevCredits + currTotalCredits;
    const cumulativeCgpa = ((prevCgpa * prevCredits) + currTotalPoints) / totalCredits;

    document.getElementById('result').innerHTML = `
      ðŸ“˜ <strong>Current Semester CGPA:</strong> ${currCgpa.toFixed(2)}<br>
      ðŸ§¾ <strong>Cumulative CGPA:</strong> ${cumulativeCgpa.toFixed(2)}
    `;

    plotChart(currCgpa.toFixed(2), cumulativeCgpa.toFixed(2));
  }

  function plotChart(curr, cumulative) {
    const ctx = document.getElementById('cgpaChart').getContext('2d');

    if (chart) chart.destroy();

    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Semester CGPA', 'Cumulative CGPA'],
        datasets: [{
          label: 'CGPA',
          data: [curr, cumulative],
          backgroundColor: ['#4e54c8', '#6c70f3']
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            max: 10,
            ticks: {
              color: document.body.classList.contains('dark-mode') ? "#fff" : "#000"
            }
          },
          x: {
            ticks: {
              color: document.body.classList.contains('dark-mode') ? "#fff" : "#000"
            }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  }

  async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const curr = document.querySelector('#result');
  if (!curr.innerHTML.trim()) {
    alert("Please calculate CGPA first.");
    return;
  }

  const lines = curr.innerText.split('\n').map(line => line.replace(/^ðŸ“˜|ðŸ§¾/, '').trim());

  pdf.setFontSize(16);
  pdf.setFont("helvetica", "bold");
  pdf.text("CGPA Calculation Result", 20, 20);

  pdf.setFont("helvetica", "normal");
  pdf.setFontSize(12);
  pdf.text(lines[0], 20, 35);
  pdf.text(lines[1], 20, 45);

  const canvas = document.getElementById("cgpaChart");
  const imgData = canvas.toDataURL("image/png");
  pdf.addImage(imgData, "PNG", 15, 60, 180, 80);

  pdf.save("cgpa_result.pdf");
}

</script>

</body>
</html>
